{"results": [{"node": {"raw_sql": "{{\r\n  config(\r\n\tmaterialized='view'\r\n    \r\n  )\r\n}}\r\n\r\nselect trunc(entitlement_expiry_dttm) as date,\r\ncase when billing_sku_country_cd is null then '4.NA' when billing_sku_country_cd in ('united states', 'us' , 'usa' ) then '1.US' \r\nwhen billing_sku_country_cd in ('united kingdom', 'ireland', 'isle of man', 'jersey', 'guernsey', 'je' , 'gg' , 'im' , 'ie') \r\nthen '2.UK/IRE' else '3.ROW' end as country,\r\ncase when first_charged_dttm is null then 'Trial' else 'Paid' end as order_status,\r\n--using revoked_dttm since it's matching with legacy table\r\ncase when revoked_dttm is null then 'Voluntary' else 'Involuntary' end as cancel_type,\r\ncase when payment_method like '%roku%' then 'Roku' when payment_method like '%paypal%' then 'Paypal'  when product_sku like '%retail%' then 'Retail Card' else 'Managed Payment' end as payment_method,\r\ncase when payments between 0 and 1 then '0-1'\r\nwhen payments between 2 and 3 then '2-3'\r\nwhen payments between 4 and 6 then '4-6'\r\nwhen payments between 7 and 12 then '7-12'\r\nelse '13+' end as payments_count,\r\ncount(distinct order_id) as total_losses\r\nfrom (select * from(select *, max(payment_count) over (partition by order_id) as payments,\r\nrow_number() over (partition by order_id order by as_on_date desc) as rk from {{ref('fact_daily_subscription_order_status')}}) where rk=1)\r\nwhere trunc(entitlement_expiry_dttm) >= '2019-09-01' and entitlement_expiry_dttm < as_on_date\r\ngroup by 1,2,3,4,5,6 order by 1,2,3,4,5,6", "database": "entdwdb", "schema": "dwh_read_write", "fqn": ["dbt_projects", "aggr_daily_monthly_network_adds_perf_track", "vw_aggr_daily_network_adds_and_loss_track"], "unique_id": "model.dbt_projects.vw_aggr_daily_network_adds_and_loss_track", "package_name": "dbt_projects", "root_path": "/home/ec2-user/workspace/deploy", "path": "aggr_daily_monthly_network_adds_perf_track/vw_aggr_daily_network_adds_and_loss_track.sql", "original_file_path": "models/aggr_daily_monthly_network_adds_perf_track/vw_aggr_daily_network_adds_and_loss_track.sql", "name": "vw_aggr_daily_network_adds_and_loss_track", "resource_type": "model", "alias": "vw_aggr_daily_network_adds_and_loss_track", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["fact_daily_subscription_order_status"]], "sources": [], "depends_on": {"nodes": ["model.dbt_projects.fact_daily_subscription_order_status"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/dbt_projects/aggr_daily_monthly_network_adds_perf_track/vw_aggr_daily_network_adds_and_loss_track.sql", "compiled": true, "compiled_sql": "\n\nselect trunc(entitlement_expiry_dttm) as date,\ncase when billing_sku_country_cd is null then '4.NA' when billing_sku_country_cd in ('united states', 'us' , 'usa' ) then '1.US' \nwhen billing_sku_country_cd in ('united kingdom', 'ireland', 'isle of man', 'jersey', 'guernsey', 'je' , 'gg' , 'im' , 'ie') \nthen '2.UK/IRE' else '3.ROW' end as country,\ncase when first_charged_dttm is null then 'Trial' else 'Paid' end as order_status,\n--using revoked_dttm since it's matching with legacy table\ncase when revoked_dttm is null then 'Voluntary' else 'Involuntary' end as cancel_type,\ncase when payment_method like '%roku%' then 'Roku' when payment_method like '%paypal%' then 'Paypal'  when product_sku like '%retail%' then 'Retail Card' else 'Managed Payment' end as payment_method,\ncase when payments between 0 and 1 then '0-1'\nwhen payments between 2 and 3 then '2-3'\nwhen payments between 4 and 6 then '4-6'\nwhen payments between 7 and 12 then '7-12'\nelse '13+' end as payments_count,\ncount(distinct order_id) as total_losses\nfrom (select * from(select *, max(payment_count) over (partition by order_id) as payments,\nrow_number() over (partition by order_id order by as_on_date desc) as rk from __dbt__CTE__fact_daily_subscription_order_status) where rk=1)\nwhere trunc(entitlement_expiry_dttm) >= '2019-09-01' and entitlement_expiry_dttm < as_on_date\ngroup by 1,2,3,4,5,6 order by 1,2,3,4,5,6", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.dbt_projects.fact_daily_subscription_order_status", "sql": " __dbt__CTE__fact_daily_subscription_order_status as (\n\n\nselect * from fds_nplus.fact_daily_subscription_order_status\n)"}], "injected_sql": "\n\nwith __dbt__CTE__fact_daily_subscription_order_status as (\n\n\nselect * from fds_nplus.fact_daily_subscription_order_status\n)select trunc(entitlement_expiry_dttm) as date,\ncase when billing_sku_country_cd is null then '4.NA' when billing_sku_country_cd in ('united states', 'us' , 'usa' ) then '1.US' \nwhen billing_sku_country_cd in ('united kingdom', 'ireland', 'isle of man', 'jersey', 'guernsey', 'je' , 'gg' , 'im' , 'ie') \nthen '2.UK/IRE' else '3.ROW' end as country,\ncase when first_charged_dttm is null then 'Trial' else 'Paid' end as order_status,\n--using revoked_dttm since it's matching with legacy table\ncase when revoked_dttm is null then 'Voluntary' else 'Involuntary' end as cancel_type,\ncase when payment_method like '%roku%' then 'Roku' when payment_method like '%paypal%' then 'Paypal'  when product_sku like '%retail%' then 'Retail Card' else 'Managed Payment' end as payment_method,\ncase when payments between 0 and 1 then '0-1'\nwhen payments between 2 and 3 then '2-3'\nwhen payments between 4 and 6 then '4-6'\nwhen payments between 7 and 12 then '7-12'\nelse '13+' end as payments_count,\ncount(distinct order_id) as total_losses\nfrom (select * from(select *, max(payment_count) over (partition by order_id) as payments,\nrow_number() over (partition by order_id order by as_on_date desc) as rk from __dbt__CTE__fact_daily_subscription_order_status) where rk=1)\nwhere trunc(entitlement_expiry_dttm) >= '2019-09-01' and entitlement_expiry_dttm < as_on_date\ngroup by 1,2,3,4,5,6 order by 1,2,3,4,5,6", "wrapped_sql": "None"}, "error": null, "status": "CREATE VIEW", "execution_time": 30.30261492729187, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-04-30T14:25:38.213391Z", "completed_at": "2020-04-30T14:25:38.284689Z"}, {"name": "execute", "started_at": "2020-04-30T14:25:38.285527Z", "completed_at": "2020-04-30T14:26:08.472343Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{\r\n  config(\r\n\tmaterialized='view'\r\n    \r\n  )\r\n}}\r\n\r\nwith ap as ( select * from (select order_id, extract (month from org_billing_dttm) as dt_mon,\r\ntrunc(org_billing_dttm) as ori_bill_dt , trunc(scheduled_billing_dttm) as sch_bill_dt ,\r\npayment_status,active_status ,\r\ncase when billing_country_cd is null then '4.NA' when billing_country_cd in ('united states', 'us' , 'usa' ) then '1.US'\r\nwhen billing_country_cd in ('united kingdom', 'ireland', 'isle of man', 'jersey', 'guernsey', 'je' , 'gg' , 'im' , 'ie')\r\nthen '2.UK/IRE' else '3.ROW' end as country,\r\ncase when payment_method = 'roku_iap'  then 'roku'\r\nwhen product_sku like '%retail%' then 'RC' else 'managed payment' end\r\nas payment_type,\r\ncase when revoked_dttm is null then 'Voluntary' else 'Involuntary' end as cancel_type,\r\ncase when payment_count between 0 and 1 then '0-1'\r\n                when payment_count between 2 and 3 then '2-3'\r\n                when payment_count between 4 and 6 then '4-6'\r\n                when payment_count between 7 and 12 then '7-12'\r\n                else '13+' end as Payments,row_number() over (partition by order_id, trunc(org_billing_dttm)  order by as_on_date desc) as rk,\r\nmax(case when revoked_dttm is null then 0 else 1 end ) as f_dt_ind ,\r\nmax(case when coalesce(trunc(revoked_dttm)) is not null  then 1 else 0 end) as invol_loss_ind,\r\nmax(case when trunc(scheduled_billing_dttm) > trunc(org_billing_dttm) then 1 else 0 end) as sf_ind\r\nfrom {{ref('fact_daily_subscription_order_status')}} where trunc(initial_order_dttm) < trunc(org_billing_dttm)\r\ngroup by 1,2,3,4,5,6,7,8,9,10,as_on_date)\r\nwhere rk = 1)\r\nselect\r\ndt_mon billing_month,\r\nori_bill_dt original_billing_date,\r\npayment_status as order_status,\r\ncountry,\r\npayment_type payment_type,\r\ncount(order_id) as renewed_count ,\r\ncount(case when sch_bill_dt = ori_bill_dt and f_dt_ind = 1 and active_status <> 'active' then order_id end) as hard_fail_indicator,\r\nsum(case when active_status = 'active' then 1 else 0  end) as renewed_total,\r\nsum(case when active_status <> 'active' and f_dt_ind = 1 then 1 else 0  end) as involuntary_cancels_count,\r\nsum(case when active_status <> 'active' and f_dt_ind = 0 then 1 else 0 end) as voluntary_cancels_count,\r\nsum(sf_ind) as soft_fail_enter ,\r\nsum(case when active_status = 'active' and sf_ind = 1 then 1 else 0  end) as soft_fail_successful_enter,\r\nPayments payments_count,\r\ncancel_type\r\nfrom ap group by 1,2,3,4,5,Payments,cancel_type", "database": "entdwdb", "schema": "dwh_read_write", "fqn": ["dbt_projects", "aggr_daily_monthly_network_adds_perf_track", "vw_aggr_monthly_network_perf_renewal_payment_track"], "unique_id": "model.dbt_projects.vw_aggr_monthly_network_perf_renewal_payment_track", "package_name": "dbt_projects", "root_path": "/home/ec2-user/workspace/deploy", "path": "aggr_daily_monthly_network_adds_perf_track/vw_aggr_monthly_network_perf_renewal_payment_track.sql", "original_file_path": "models/aggr_daily_monthly_network_adds_perf_track/vw_aggr_monthly_network_perf_renewal_payment_track.sql", "name": "vw_aggr_monthly_network_perf_renewal_payment_track", "resource_type": "model", "alias": "vw_aggr_monthly_network_perf_renewal_payment_track", "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["fact_daily_subscription_order_status"]], "sources": [], "depends_on": {"nodes": ["model.dbt_projects.fact_daily_subscription_order_status"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/dbt_projects/aggr_daily_monthly_network_adds_perf_track/vw_aggr_monthly_network_perf_renewal_payment_track.sql", "compiled": true, "compiled_sql": "\n\nwith ap as ( select * from (select order_id, extract (month from org_billing_dttm) as dt_mon,\ntrunc(org_billing_dttm) as ori_bill_dt , trunc(scheduled_billing_dttm) as sch_bill_dt ,\npayment_status,active_status ,\ncase when billing_country_cd is null then '4.NA' when billing_country_cd in ('united states', 'us' , 'usa' ) then '1.US'\nwhen billing_country_cd in ('united kingdom', 'ireland', 'isle of man', 'jersey', 'guernsey', 'je' , 'gg' , 'im' , 'ie')\nthen '2.UK/IRE' else '3.ROW' end as country,\ncase when payment_method = 'roku_iap'  then 'roku'\nwhen product_sku like '%retail%' then 'RC' else 'managed payment' end\nas payment_type,\ncase when revoked_dttm is null then 'Voluntary' else 'Involuntary' end as cancel_type,\ncase when payment_count between 0 and 1 then '0-1'\n                when payment_count between 2 and 3 then '2-3'\n                when payment_count between 4 and 6 then '4-6'\n                when payment_count between 7 and 12 then '7-12'\n                else '13+' end as Payments,row_number() over (partition by order_id, trunc(org_billing_dttm)  order by as_on_date desc) as rk,\nmax(case when revoked_dttm is null then 0 else 1 end ) as f_dt_ind ,\nmax(case when coalesce(trunc(revoked_dttm)) is not null  then 1 else 0 end) as invol_loss_ind,\nmax(case when trunc(scheduled_billing_dttm) > trunc(org_billing_dttm) then 1 else 0 end) as sf_ind\nfrom __dbt__CTE__fact_daily_subscription_order_status where trunc(initial_order_dttm) < trunc(org_billing_dttm)\ngroup by 1,2,3,4,5,6,7,8,9,10,as_on_date)\nwhere rk = 1)\nselect\ndt_mon billing_month,\nori_bill_dt original_billing_date,\npayment_status as order_status,\ncountry,\npayment_type payment_type,\ncount(order_id) as renewed_count ,\ncount(case when sch_bill_dt = ori_bill_dt and f_dt_ind = 1 and active_status <> 'active' then order_id end) as hard_fail_indicator,\nsum(case when active_status = 'active' then 1 else 0  end) as renewed_total,\nsum(case when active_status <> 'active' and f_dt_ind = 1 then 1 else 0  end) as involuntary_cancels_count,\nsum(case when active_status <> 'active' and f_dt_ind = 0 then 1 else 0 end) as voluntary_cancels_count,\nsum(sf_ind) as soft_fail_enter ,\nsum(case when active_status = 'active' and sf_ind = 1 then 1 else 0  end) as soft_fail_successful_enter,\nPayments payments_count,\ncancel_type\nfrom ap group by 1,2,3,4,5,Payments,cancel_type", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.dbt_projects.fact_daily_subscription_order_status", "sql": " __dbt__CTE__fact_daily_subscription_order_status as (\n\n\nselect * from fds_nplus.fact_daily_subscription_order_status\n)"}], "injected_sql": "\n\nwith  __dbt__CTE__fact_daily_subscription_order_status as (\n\n\nselect * from fds_nplus.fact_daily_subscription_order_status\n),ap as ( select * from (select order_id, extract (month from org_billing_dttm) as dt_mon,\ntrunc(org_billing_dttm) as ori_bill_dt , trunc(scheduled_billing_dttm) as sch_bill_dt ,\npayment_status,active_status ,\ncase when billing_country_cd is null then '4.NA' when billing_country_cd in ('united states', 'us' , 'usa' ) then '1.US'\nwhen billing_country_cd in ('united kingdom', 'ireland', 'isle of man', 'jersey', 'guernsey', 'je' , 'gg' , 'im' , 'ie')\nthen '2.UK/IRE' else '3.ROW' end as country,\ncase when payment_method = 'roku_iap'  then 'roku'\nwhen product_sku like '%retail%' then 'RC' else 'managed payment' end\nas payment_type,\ncase when revoked_dttm is null then 'Voluntary' else 'Involuntary' end as cancel_type,\ncase when payment_count between 0 and 1 then '0-1'\n                when payment_count between 2 and 3 then '2-3'\n                when payment_count between 4 and 6 then '4-6'\n                when payment_count between 7 and 12 then '7-12'\n                else '13+' end as Payments,row_number() over (partition by order_id, trunc(org_billing_dttm)  order by as_on_date desc) as rk,\nmax(case when revoked_dttm is null then 0 else 1 end ) as f_dt_ind ,\nmax(case when coalesce(trunc(revoked_dttm)) is not null  then 1 else 0 end) as invol_loss_ind,\nmax(case when trunc(scheduled_billing_dttm) > trunc(org_billing_dttm) then 1 else 0 end) as sf_ind\nfrom __dbt__CTE__fact_daily_subscription_order_status where trunc(initial_order_dttm) < trunc(org_billing_dttm)\ngroup by 1,2,3,4,5,6,7,8,9,10,as_on_date)\nwhere rk = 1)\nselect\ndt_mon billing_month,\nori_bill_dt original_billing_date,\npayment_status as order_status,\ncountry,\npayment_type payment_type,\ncount(order_id) as renewed_count ,\ncount(case when sch_bill_dt = ori_bill_dt and f_dt_ind = 1 and active_status <> 'active' then order_id end) as hard_fail_indicator,\nsum(case when active_status = 'active' then 1 else 0  end) as renewed_total,\nsum(case when active_status <> 'active' and f_dt_ind = 1 then 1 else 0  end) as involuntary_cancels_count,\nsum(case when active_status <> 'active' and f_dt_ind = 0 then 1 else 0 end) as voluntary_cancels_count,\nsum(sf_ind) as soft_fail_enter ,\nsum(case when active_status = 'active' and sf_ind = 1 then 1 else 0  end) as soft_fail_successful_enter,\nPayments payments_count,\ncancel_type\nfrom ap group by 1,2,3,4,5,Payments,cancel_type", "wrapped_sql": "None"}, "error": null, "status": "CREATE VIEW", "execution_time": 32.56637096405029, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-04-30T14:25:38.205057Z", "completed_at": "2020-04-30T14:25:38.285135Z"}, {"name": "execute", "started_at": "2020-04-30T14:25:38.295847Z", "completed_at": "2020-04-30T14:26:10.745867Z"}], "fail": null, "warn": null, "skip": false}], "generated_at": "2020-04-30T14:26:10.846662Z", "elapsed_time": 33.480183124542236}